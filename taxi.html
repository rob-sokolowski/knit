cat <<EOF
<!DOCTYPE html>
<html>
<head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

<script>
var input = \`
$(<$1)
\`;

input = input.split('\n').slice(2, -1).map(x => x.split(','));
var data = input.map(x => ({x: parseInt(x[0]), y: parseFloat(x[2])}));

const margin = { top: 20, right: 30, bottom: 30, left: 40 };
const width = 800;
const height = 500;

const x = d3.scaleLinear()
    .domain([0, d3.max(data, d => d.x)])
    .range([margin.left, width - margin.right]);

const y = d3.scaleLinear()
    .domain([0, d3.max(data, d => d.y)]).nice()
    .range([height - margin.bottom, margin.top]);

const line = d3.line()
    .x(d => x(d.x))
    .y(d => y(d.y));

let svg = d3.select('body').append('svg')
    .attr('viewBox', [0, 0, width, height])
    .style('max-width', '900px');

svg.append('g')
    .attr('transform', \`translate(\${margin.left}, 0)\`)
    .call(d3.axisLeft(y));

svg.append('g')
    .attr('transform', \`translate(0, \${height - margin.bottom})\`)
    .call(d3.axisBottom(x));

svg.append('path')
    .datum(data)
    .attr('fill', 'none')
    .attr('stroke', 'steelblue')
    .attr('stroke-width', 1.5)
    .attr('d', line);
</script>

</body>
</html>
EOF
